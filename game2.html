<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç‰æ¡‚ç‹—ç„¡é™æ‡‰ç”¨é¡Œ</title>
    <style>
        :root { --cinna-blue: #b3e5fc; --cinna-pink: #ffc1e3; --bg: #f9feff; }
        body { font-family: 'Noto Sans TC', sans-serif; background: var(--bg); padding: 15px; text-align: center; }
        .card { background: white; border-radius: 25px; border: 3px solid var(--cinna-blue); padding: 20px; max-width: 500px; margin: 0 auto; box-shadow: 0 8px 20px rgba(0,0,0,0.05); }
        .problem-text { font-size: 1.3rem; line-height: 1.8; color: #455a64; text-align: left; margin: 20px 0; min-height: 100px; background: #fffaf0; padding: 15px; border-radius: 15px; }
        .keyword { color: #f06292; font-weight: bold; border-bottom: 2px dashed #f06292; }
        .btn { background: white; border: 2px solid var(--cinna-blue); padding: 12px; border-radius: 12px; cursor: pointer; font-size: 1rem; }
        .btn:active { background: var(--cinna-blue); color: white; }
        .answer-input { width: 100px; font-size: 1.5rem; border: none; border-bottom: 3px solid var(--cinna-pink); text-align: center; margin: 10px; }
        .reward { font-size: 4rem; display: none; }
    </style>
</head>
<body>

    <div class="card">
        <h3 style="color:var(--cinna-blue)">ğŸ§ ç„¡é™æ‡‰ç”¨é¡ŒæŒ‘æˆ°</h3>
        <div id="problem-display" class="problem-text">é»æ“ŠæŒ‰éˆ•é–‹å§‹...</div>
        
        <div id="step-1">
            <p>é€™é¡Œè¦ç”¨ä»€éº¼æ–¹æ³•ï¼Ÿ</p>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <button class="btn" onclick="checkStep1('+')">åŠ æ³• (+)</button>
                <button class="btn" onclick="checkStep1('-')">æ¸›æ³• (-)</button>
                <button class="btn" onclick="checkStep1('x')">ä¹˜æ³• (Ã—)</button>
                <button class="btn" onclick="checkStep1('Ã·')">é™¤æ³• (Ã·)</button>
            </div>
        </div>

        <div id="step-2" style="display:none; margin-top:20px;">
            <p>ç­”æ¡ˆæ˜¯å¤šå°‘ï¼Ÿ</p>
            <input type="number" id="user-ans" class="answer-input" inputmode="numeric">
            <button class="btn" style="background:var(--cinna-pink); color:white; border:none;" onclick="checkStep2()">æäº¤</button>
        </div>

        <div id="reward" class="reward">âœ¨</div>
        <button id="next-btn" class="btn" style="display:none; width:100%; margin-top:20px;" onclick="generateProblem()">ä¸‹ä¸€é¡Œ ğŸš€</button>
    </div>

    <script>
        let currentProblem = {};

        const templates = [
            {
                type: 'x',
                getText: (n1, n2, item) => `ç‰æ¡‚ç‹—æœ‰ ${n1} ç›’${item}ï¼Œæ¯ç›’æœ‰ ${n2} å€‹ï¼Œ<span class='keyword'>ä¸€å…±æœ‰</span>${item}å¤šå°‘å€‹ï¼Ÿ`,
                hint: "æ¯ç›’æœ‰ç›¸åŒæ•¸é‡ï¼Œæ±‚ç¸½æ•¸è¦ç”¨ã€ä¹˜æ³•ã€å–”ï¼"
            },
            {
                type: 'Ã·',
                getText: (n1, n2, item) => `è€å¸«æœ‰ ${n1 * n2} ç²’${item}ï¼Œ<span class='keyword'>å¹³å‡åˆ†çµ¦</span> ${n1} ä½åŒå­¸ï¼Œæ¯äººå¯å¾—${item}å¤šå°‘ç²’ï¼Ÿ`,
                hint: "ã€å¹³å‡åˆ†é…ã€æ˜¯ã€é™¤æ³•ã€çš„é—œéµä¿¡è™Ÿï¼"
            },
            {
                type: '-',
                getText: (n1, n2, item) => `å•†åº—åŸæœ‰ ${n1+n2} å€‹${item}ï¼Œä»Šå¤©<span class='keyword'>è³£å‡ºäº†</span> ${n2} å€‹ï¼Œé‚„<span class='keyword'>å‰©ä¸‹</span>å¤šå°‘å€‹ï¼Ÿ`,
                hint: "æ•¸é‡è®Šå°‘äº†ï¼Œæ±‚å‰©ä¸‹çš„è¦ç”¨ã€æ¸›æ³•ã€ã€‚"
            },
            {
                type: '+',
                getText: (n1, n2, item) => `å°æ˜è²·äº† ${n1} å€‹${item}ï¼Œåª½åª½å†é€çµ¦ä»– ${n2} å€‹ï¼Œä»–<span class='keyword'>ç¾åœ¨å…±æœ‰</span>å¤šå°‘å€‹ï¼Ÿ`,
                hint: "æ•¸é‡å¢åŠ äº†ï¼Œæ±‚ç¸½æ•¸ç”¨ã€åŠ æ³•ã€ã€‚"
            }
        ];

        const items = ["ç³–æœ", "ç”œç”œåœˆ", "è²¼ç´™", "å·§å…‹åŠ›", "æ–‡å…·", "è˜‹æœ"];

        function generateProblem() {
            const temp = templates[Math.floor(Math.random() * templates.length)];
            const item = items[Math.floor(Math.random() * items.length)];
            const n1 = Math.floor(Math.random() * 10) + 2;
            const n2 = Math.floor(Math.random() * 8) + 2;

            let ans;
            if (temp.type === 'x') ans = n1 * n2;
            else if (temp.type === 'Ã·') ans = n2; // n1*n2 / n1
            else if (temp.type === '-') ans = n1; // (n1+n2) - n2
            else ans = n1 + n2;

            currentProblem = { text: temp.getText(n1, n2, item), type: temp.type, ans: ans, hint: temp.hint };
            
            document.getElementById('problem-display').innerHTML = currentProblem.text;
            document.getElementById('step-1').style.display = 'block';
            document.getElementById('step-2').style.display = 'none';
            document.getElementById('reward').style.display = 'none';
            document.getElementById('next-btn').style.display = 'none';
            document.getElementById('user-ans').value = '';
            
            speak(document.getElementById('problem-display').innerText);
        }

        function checkStep1(op) {
            if (op === currentProblem.type) {
                speak("ç­”å°äº†ï¼é‹ç®—æ­£ç¢ºã€‚");
                document.getElementById('step-1').style.display = 'none';
                document.getElementById('step-2').style.display = 'block';
            } else {
                speak("å†æƒ³ä¸€æƒ³ï¼Œ" + currentProblem.hint);
            }
        }

        function checkStep2() {
            if (parseInt(document.getElementById('user-ans').value) === currentProblem.ans) {
                speak("å¤ªæ£’äº†ï¼è¨ˆç®—æ­£ç¢ºã€‚");
                document.getElementById('reward').style.display = 'block';
                document.getElementById('next-btn').style.display = 'block';
                document.getElementById('step-2').style.display = 'none';
            } else {
                speak("ç®—éŒ¯äº†ï¼Œå†è©¦ä¸€æ¬¡ï¼");
            }
        }

        function speak(t) {
            const u = new SpeechSynthesisUtterance(t);
            u.lang = 'zh-HK'; u.rate = 0.8;
            window.speechSynthesis.speak(u);
        }

        window.onload = generateProblem;
    </script>
</body>
</html>
