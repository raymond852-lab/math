<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç‰æ¡‚ç‹—æ•¸å­¸ Level Up</title>
    <style>
        :root { --cinna-blue: #b3e5fc; --cinna-pink: #ffc1e3; --bg: #f9feff; }
        body { font-family: 'Noto Sans TC', sans-serif; background: var(--bg); padding: 15px; text-align: center; }
        .card { background: white; border-radius: 25px; border: 3px solid var(--cinna-blue); padding: 20px; max-width: 500px; margin: 0 auto; box-shadow: 0 8px 20px rgba(0,0,0,0.05); }
        
        /* ç­‰ç´šé¸æ“‡å™¨ */
        .lvl-selector { display: flex; gap: 10px; margin-bottom: 20px; }
        .lvl-btn { flex: 1; padding: 10px; border-radius: 15px; border: 2px solid #ddd; background: #fff; cursor: pointer; font-weight: bold; }
        .lvl-btn.active { border-color: var(--cinna-blue); background: #e1f5fe; color: #0288d1; }

        .problem-text { font-size: 1.2rem; line-height: 1.6; color: #455a64; text-align: left; margin: 15px 0; background: #fffaf0; padding: 15px; border-radius: 15px; min-height: 80px; }
        .keyword { color: #f06292; font-weight: bold; border-bottom: 2px dashed #f06292; }
        
        .step-box { background: #f1f8e9; border-radius: 15px; padding: 15px; margin-top: 15px; border-left: 5px solid #8bc34a; text-align: left; }
        .btn { background: white; border: 2px solid var(--cinna-blue); padding: 10px; border-radius: 10px; cursor: pointer; font-size: 0.9rem; margin: 2px; }
        .btn-main { background: var(--cinna-pink); color: white; border: none; padding: 15px; border-radius: 30px; width: 100%; font-size: 1.2rem; margin-top: 10px; box-shadow: 0 4px 0 #f06292; }
        
        input { width: 80px; font-size: 1.2rem; border: none; border-bottom: 2px solid var(--cinna-pink); text-align: center; outline: none; }
        .reward { font-size: 3rem; display: none; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="card">
        <div class="lvl-selector">
            <button id="btn-l1" class="lvl-btn active" onclick="setLevel(1)">Level 1<br><small>ä¸€æ­¥é‹ç®—</small></button>
            <button id="btn-l2" class="lvl-btn" onclick="setLevel(2)">Level 2<br><small>å…©æ­¥é‹ç®—</small></button>
        </div>

        <div id="problem-display" class="problem-text">è¼‰å…¥ä¸­...</div>
        <button onclick="speakProblem()" style="background:none; border:none; font-size:1.5rem; cursor:pointer;">ğŸ”Š è®€é¡Œ</button>

        <div id="step-logic" style="margin-top:15px;">
            <p id="logic-title" style="font-weight:bold; color:#546e7a;">é€™é¡Œè¦æ€éº¼ç®—ï¼Ÿ</p>
            <div id="op-container" style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
                </div>
        </div>

        <div id="step-answer" style="display:none; margin-top:15px;">
            <div class="step-box">
                <p style="margin:0 0 10px 0;">ğŸŒŸ <b>è¨ˆç®—æŒ‘æˆ°ï¼š</b></p>
                <input type="number" id="final-ans" inputmode="numeric"> å…ƒ / å€‹ / ç²’
            </div>
            <button class="btn-main" onclick="checkFinal()">æäº¤ç­”æ¡ˆ</button>
        </div>

        <div id="reward" class="reward">ğŸ­</div>
        <button id="next-btn" class="btn-main" style="display:none; background:#81c784; box-shadow:0 4px 0 #66bb6a;" onclick="generateProblem()">ä¸‹ä¸€é¡Œ ğŸš€</button>
    </div>

    <script>
        let currentLevel = 1;
        let currentProblem = {};
        const items = ["ç³–æœ", "è²¼ç´™", "å·§å…‹åŠ›", "è˜‹æœ", "æ–‡å…·", "å°è›‹ç³•"];

        function setLevel(l) {
            currentLevel = l;
            document.getElementById('btn-l1').className = 'lvl-btn' + (l==1?' active':'');
            document.getElementById('btn-l2').className = 'lvl-btn' + (l==2?' active':'');
            generateProblem();
        }

        const templatesL1 = [
            { type: 'x', get: (n1, n2, i) => [`ç‰æ¡‚ç‹—è²·äº† ${n1} ç›’${i}ï¼Œæ¯ç›’æœ‰ ${n2} ç²’ï¼Œ<span class='keyword'>ä¸€å…±æœ‰</span>å¤šå°‘ç²’ï¼Ÿ`, n1*n2, "ã€æ¯ç›’æœ‰ã€é…ã€ä¸€å…±ã€è¦ç”¨ä¹˜æ³•ã€‚"] },
            { type: 'Ã·', get: (n1, n2, i) => [`è€å¸«æœ‰ ${n1*n2} ç²’${i}ï¼Œ<span class='keyword'>å¹³å‡åˆ†çµ¦</span> ${n1} äººï¼Œæ¯äººæœ‰å¹¾ç²’ï¼Ÿ`, n2, "ã€å¹³å‡åˆ†ã€è¦ç”¨é™¤æ³•ã€‚"] }
        ];

        const templatesL2 = [
            { // (A + B) / C
                type: '(+)/', 
                get: (n1, n2, i) => {
                    let total = (n1 + n2) * 5; // ç¢ºä¿èƒ½è¢« 5 æ•´é™¤
                    return [`ç‰æ¡‚ç‹—æœ‰ ${n1*5} ç²’ç´…${i}å’Œ ${n2*5} ç²’é»ƒ${i}ï¼Œä»–æŠŠå…¨éƒ¨${i}<span class='keyword'>å¹³å‡åˆ†çµ¦</span> 5 ä½æœ‹å‹ï¼Œæ¯äººå¾—å¹¾ç²’ï¼Ÿ`, (n1*5+n2*5)/5, "å…ˆåŠ èµ·ç¸½æ•¸ï¼Œå†é™¤ä»¥äººæ•¸ã€‚"];
                }
            },
            { // A - (B * C)
                type: '-(x)',
                get: (n1, n2, i) => {
                    let price = 8;
                    let pay = 100;
                    return [`åª½åª½çµ¦äº†ç‰æ¡‚ç‹— $${pay}ï¼Œä»–è²·äº† ${n1} å€‹æ¯å€‹ $${price} çš„${i}ï¼Œæ‡‰<span class='keyword'>æ‰¾å›</span>å¤šå°‘éŒ¢ï¼Ÿ`, pay - (n1*price), "å…ˆç®—å‡ºç¸½èŠ±è²» (ä¹˜æ³•)ï¼Œå†ç”¨æ¸›æ³•ç®—æ‰¾è´–ã€‚"];
                }
            }
        ];

        function generateProblem() {
            const list = (currentLevel === 1) ? templatesL1 : templatesL2;
            const temp = list[Math.floor(Math.random() * list.length)];
            const i = items[Math.floor(Math.random() * items.length)];
            const n1 = Math.floor(Math.random() * 8) + 2;
            const n2 = Math.floor(Math.random() * 5) + 2;
            
            const [text, ans, hint] = temp.get(n1, n2, i);
            currentProblem = { text, ans, hint, type: temp.type };

            document.getElementById('problem-display').innerHTML = text;
            document.getElementById('step-logic').style.display = 'block';
            document.getElementById('step-answer').style.display = 'none';
            document.getElementById('reward').style.display = 'none';
            document.getElementById('next-btn').style.display = 'none';
            document.getElementById('final-ans').value = '';
            
            setupLogicButtons();
            speakProblem();
        }

        function setupLogicButtons() {
            const container = document.getElementById('op-container');
            container.innerHTML = '';
            const ops = (currentLevel === 1) ? ['+', '-', 'x', 'Ã·'] : ['å…ˆåŠ å¾Œé™¤', 'å…ˆä¹˜å¾Œæ¸›', 'å…ˆæ¸›å¾Œä¹˜', 'é€£ä¹˜æ³•'];
            const correctMap = { 'x':'x', 'Ã·':'Ã·', '(+)/':'å…ˆåŠ å¾Œé™¤', '-(x)':'å…ˆä¹˜å¾Œæ¸›' };

            ops.forEach(op => {
                const b = document.createElement('button');
                b.className = 'btn';
                b.innerText = op;
                b.onclick = () => {
                    if(op === correctMap[currentProblem.type]) {
                        speak("æ­£ç¢ºï¼é–‹å§‹è¨ˆç®—å§ã€‚");
                        document.getElementById('step-logic').style.display = 'none';
                        document.getElementById('step-answer').style.display = 'block';
                    } else {
                        speak("ä¸å°å–”ï¼Œ" + currentProblem.hint);
                    }
                };
                container.appendChild(b);
            });
        }

        function checkFinal() {
            const val = parseInt(document.getElementById('final-ans').value);
            if(val === currentProblem.ans) {
                speak("å¤ªè°æ˜äº†ï¼ç®—å°äº†ï¼");
                document.getElementById('reward').style.display = 'block';
                document.getElementById('next-btn').style.display = 'block';
                document.getElementById('step-answer').style.display = 'none';
            } else {
                speak("è¨ˆç®—éŒ¯äº†ï¼Œå†æª¢æŸ¥ä¸€ä¸‹ã€‚");
            }
        }

        function speakProblem() {
            const u = new SpeechSynthesisUtterance(document.getElementById('problem-display').innerText.replace(/<[^>]*>/g, ''));
            u.lang = 'zh-HK'; u.rate = 0.8; window.speechSynthesis.speak(u);
        }

        function speak(t) {
            const u = new SpeechSynthesisUtterance(t);
            u.lang = 'zh-HK'; window.speechSynthesis.speak(u);
        }

        window.onload = generateProblem;
    </script>
</body>
</html>
